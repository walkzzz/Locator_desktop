# Locator_desktop 用户手册

## 1. 产品概述

### 1.1 什么是Locator_desktop

Locator_desktop是一款功能强大的桌面应用元素定位工具，专为自动化测试工程师和RPA开发人员设计。它提供了直观的用户界面，支持多种定位方式，能够自动生成符合规范的定位代码，极大简化了桌面应用元素定位的工作流程。

### 1.2 核心功能

- ✅ 直观的用户界面，操作简单易用
- ✅ 实时元素捕获，支持鼠标悬停选择
- ✅ 多种定位方式：属性定位、图像识别定位、坐标定位
- ✅ 自动生成pywinauto和uiautomation定位代码
- ✅ 元素树清晰展示UI层级关系
- ✅ 详细的元素属性信息
- ✅ 定位代码实时测试和验证
- ✅ 支持多种应用类型（MFC、WinForms、WPF、Qt等）

### 1.3 系统要求

| 项目 | 要求 |
|------|------|
| 操作系统 | Windows 7 SP1、Windows 10、Windows 11 |
| Python版本 | Python 3.8或更高版本 |
| 磁盘空间 | 至少100MB可用空间 |
| 内存 | 至少2GB RAM |
| 显卡 | 支持DirectX 9或更高版本 |

## 2. 安装指南

### 2.1 安装方式

Locator_desktop支持两种安装方式：

1. **在线安装**：通过pip命令在线安装（推荐）
2. **离线安装**：使用离线安装包安装

### 2.2 在线安装步骤

1. **安装Python**：
   - 从[Python官网](https://www.python.org/downloads/)下载并安装Python 3.8或更高版本
   - 安装时请勾选"Add Python to PATH"

2. **安装Locator_desktop**：
   - 打开命令提示符（CMD）或PowerShell
   - 运行以下命令：
     ```bash
     pip install locator-desktop
     ```

3. **启动应用**：
   - 安装完成后，在命令提示符中运行：
     ```bash
     locator-desktop
     ```
   - 或通过开始菜单找到Locator_desktop快捷方式启动

### 2.3 离线安装步骤

1. **下载离线安装包**：
   - 从官方网站下载最新的离线安装包（.exe格式）
   - 确保下载的安装包与您的操作系统版本匹配

2. **运行安装程序**：
   - 双击下载的安装包文件
   - 按照安装向导的提示进行操作
   - 选择安装目录（建议使用默认目录）
   - 点击"安装"按钮开始安装

3. **完成安装**：
   - 安装完成后，勾选"运行Locator_desktop"
   - 点击"完成"按钮启动应用

### 2.4 虚拟环境安装（可选）

如果您希望在虚拟环境中安装Locator_desktop，可以按照以下步骤操作：

1. **创建虚拟环境**：
   ```bash
   python -m venv locator-env
   ```

2. **激活虚拟环境**：
   - Windows CMD：
     ```bash
     locator-env\Scripts\activate.bat
     ```
   - Windows PowerShell：
     ```bash
     .\locator-env\Scripts\Activate.ps1
     ```

3. **安装Locator_desktop**：
   ```bash
   pip install locator-desktop
   ```

## 3. 快速入门

### 3.1 启动应用

- **方式1**：通过开始菜单启动
- **方式2**：在命令提示符中运行`locator-desktop`
- **方式3**：双击桌面快捷方式（如果创建了）

### 3.2 基本操作流程

1. **选择目标应用**：
   - 在顶部工具栏的"应用程序"输入框中输入应用路径
   - 或从"进程选择"下拉列表中选择正在运行的进程
   - 或从"窗口"下拉列表中选择目标窗口

2. **捕获元素**：
   - 点击"捕获元素"按钮
   - 将鼠标移动到目标元素上
   - 按下Ctrl键确认捕获

3. **查看元素信息**：
   - 捕获的元素将显示在左侧的"元素树"中
   - 点击元素树中的元素，查看右侧面板的详细信息
   - 查看"元素详细信息"面板了解元素属性
   - 查看"定位路径"面板了解元素在UI树中的位置

4. **生成定位代码**：
   - 在"定位代码生成"面板中查看自动生成的代码
   - 切换"pywinauto"和"uiautomation"标签页查看不同库的代码
   - 点击"复制代码"按钮将代码复制到剪贴板

5. **测试定位**：
   - 点击"测试定位"按钮验证生成的定位代码
   - 根据提示信息确认定位结果

### 3.3 定位方式选择

Locator_desktop支持三种定位方式，您可以根据需要选择：

1. **属性定位**：
   - 基于元素的属性（如automation_id、name、class_name等）进行定位
   - 推荐使用，定位稳定可靠
   - 适用于大多数标准控件

2. **图像识别定位**：
   - 通过图像匹配技术定位元素
   - 适用于难以通过属性定位的自定义控件或图像按钮
   - 需要提前准备模板图像

3. **坐标定位**：
   - 基于屏幕坐标进行定位
   - 简单直接但不稳定
   - 适用于快速定位或固定测试环境

## 4. 详细功能说明

### 4.1 应用程序选择

#### 4.1.1 应用路径输入

- **功能**：手动输入或拖拽应用程序路径
- **操作**：
  1. 点击应用路径输入框
  2. 输入应用程序的完整路径（如：`C:\Program Files\Notepad++\notepad++.exe`）
  3. 或直接拖拽应用程序图标到输入框

#### 4.1.2 进程列表

- **功能**：显示当前运行的进程，支持选择
- **操作**：
  1. 点击"进程选择"下拉列表
  2. 从列表中选择目标进程
  3. 选择后，"窗口"下拉列表将自动更新为该进程的窗口

#### 4.1.3 窗口列表

- **功能**：显示当前进程的窗口，支持选择
- **操作**：
  1. 从"窗口"下拉列表中选择目标窗口
  2. 选择后，左侧"元素树"将自动更新为该窗口的元素

### 4.2 元素捕获

#### 4.2.1 实时捕获

- **功能**：实时捕获鼠标悬停的元素
- **操作**：
  1. 点击"捕获元素"按钮
  2. 鼠标指针将变为十字形
  3. 将鼠标移动到目标元素上
  4. 按下Ctrl键确认捕获
  5. 捕获的元素将显示在"元素树"中，并选中

#### 4.2.2 元素树导航

- **功能**：以树形结构展示UI元素层级关系
- **操作**：
  1. 点击树节点前的展开/折叠按钮查看子元素
  2. 点击树节点查看元素详细信息
  3. 支持键盘导航（上/下箭头键移动，Enter键展开/折叠）

### 4.3 元素详细信息

#### 4.3.1 元素属性表

- **功能**：显示选中元素的完整属性信息
- **内容**：
  - 元素ID：元素的唯一标识
  - 元素名称：元素的显示名称
  - 元素类型：元素的控件类型
  - 元素坐标：元素在屏幕上的位置
  - 元素尺寸：元素的宽度和高度
  - AutomationID：元素的Automation ID（如果有）
  - ClassName：元素的类名
  - ControlType：元素的控件类型
  - Depth：元素在UI树中的深度

#### 4.3.2 定位路径

- **功能**：显示元素在UI树中的定位路径
- **格式**：
  ```
  <Window automation_id="main_window" depth=1>
  <Group name="container" depth=2>
  <Button automation_id="button_ok" depth=3>
  ```

### 4.4 定位代码生成

#### 4.4.1 代码标签页

- **功能**：生成不同自动化库的定位代码
- **标签页**：
  - **pywinauto**：生成pywinauto定位代码
  - **uiautomation**：生成uiautomation定位代码

#### 4.4.2 代码结构

生成的代码包含以下部分：
1. **导入语句**：必要的库导入
2. **应用连接**：连接到目标应用
3. **窗口获取**：获取目标窗口
4. **元素定位**：定位目标元素
5. **操作示例**：常用操作的示例代码

#### 4.4.3 代码复制

- **功能**：将生成的代码复制到剪贴板
- **操作**：
  1. 选择要复制的代码标签页
  2. 点击"复制代码"按钮
  3. 代码将被复制到剪贴板，可直接粘贴到您的脚本中

### 4.5 定位验证

- **功能**：测试生成的定位代码是否有效
- **操作**：
  1. 选择要测试的代码标签页
  2. 点击"测试定位"按钮
  3. 根据弹出的提示信息确认定位结果

## 5. 高级功能

### 5.1 图像识别定位

#### 5.1.1 准备模板图像

1. 使用截图工具截取目标元素的图像
2. 保存为清晰的PNG或JPG格式
3. 确保图像只包含目标元素，避免多余背景

#### 5.1.2 使用图像识别定位

1. 选择"定位方式"为"图像识别"
2. 点击"选择模板图像"按钮
3. 选择准备好的模板图像
4. 调整识别置信度（默认0.8）
5. 点击"捕获元素"按钮开始识别
6. 识别到的元素将显示在元素树中

### 5.2 坐标定位

#### 5.2.1 使用坐标定位

1. 选择"定位方式"为"坐标定位"
2. 将鼠标移动到目标位置
3. 点击"捕获元素"按钮
4. 捕获的坐标将显示在元素信息中
5. 生成的代码将包含坐标定位逻辑

### 5.3 定位策略优化

#### 5.3.1 选择最佳定位属性

Locator_desktop会自动选择最佳的定位属性组合，优先级如下：
1. **AutomationID**：最稳定的唯一标识
2. **Name**：元素的显示名称
3. **ClassName**：元素的类名
4. **ControlType**：元素的控件类型

#### 5.3.2 定位代码优化建议

- 尽量使用AutomationID进行定位，稳定性最高
- 避免使用可能变化的属性，如动态生成的Name
- 对于复杂UI，考虑使用多层级定位
- 对于图像按钮，使用图像识别定位

## 6. 使用技巧

### 6.1 提高定位稳定性

- **优先使用AutomationID**：如果元素有AutomationID，优先使用它进行定位
- **避免使用动态属性**：避免使用可能变化的属性，如动态生成的Name或随机ID
- **使用多层级定位**：对于复杂UI，使用多层级定位可以提高准确性
- **定期更新定位代码**：当应用UI发生变化时，及时更新定位代码

### 6.2 提高捕获效率

- **使用快捷键**：熟练使用Ctrl键确认捕获，提高操作速度
- **利用元素树**：直接从元素树中选择元素，避免重复捕获
- **使用查找功能**：使用"查找下一个"和"查找上一个"按钮快速定位元素
- **刷新元素树**：当UI发生变化时，点击"刷新"按钮更新元素树

### 6.3 代码使用技巧

- **直接复制使用**：生成的代码可以直接复制到您的脚本中使用
- **自定义操作**：根据需要修改生成的操作示例
- **组合使用**：结合多种定位方式，提高定位成功率
- **定期备份**：定期备份生成的定位代码，避免丢失

## 7. 常见问题解答

### 7.1 应用启动问题

**Q: 启动Locator_desktop时出现"ModuleNotFoundError"错误怎么办？**
A: 这通常是由于依赖库未正确安装导致的。请尝试重新安装Locator_desktop：
```bash
pip install --force-reinstall locator-desktop
```

**Q: 应用启动后界面显示异常怎么办？**
A: 尝试以下解决方法：
1. 更新显卡驱动
2. 确保系统已安装最新的.NET Framework
3. 以管理员身份运行应用

### 7.2 元素捕获问题

**Q: 点击"捕获元素"按钮后没有反应怎么办？**
A: 检查以下几点：
1. 是否已选择目标应用或窗口
2. 目标应用是否正在运行且可见
3. 尝试重启Locator_desktop

**Q: 无法捕获到某些元素怎么办？**
A: 尝试以下方法：
1. 切换定位方式（如从属性定位切换到图像识别定位）
2. 确保元素当前可见且未被其他窗口遮挡
3. 尝试调整捕获设置

### 7.3 定位代码问题

**Q: 生成的定位代码执行失败怎么办？**
A: 可能的原因及解决方法：
1. **元素属性变化**：应用UI已更新，重新捕获元素
2. **定位方式不当**：尝试使用其他定位方式
3. **应用状态变化**：确保应用处于预期状态
4. **权限问题**：以管理员身份运行您的脚本

**Q: 生成的代码与预期不符怎么办？**
A: 尝试以下方法：
1. 重新捕获元素，确保捕获的是正确的元素
2. 检查元素属性，选择更稳定的定位属性
3. 手动调整生成的代码

### 7.4 兼容性问题

**Q: Locator_desktop支持哪些应用类型？**
A: Locator_desktop支持大多数Windows桌面应用，包括：
- MFC应用
- WinForms应用
- WPF应用
- Qt应用
- Electron应用（部分支持）

**Q: 在某些应用上无法正常工作怎么办？**
A: 尝试以下方法：
1. 更新Locator_desktop到最新版本
2. 尝试使用不同的定位方式
3. 检查应用是否使用了特殊的UI框架

## 8. 故障排除

### 8.1 日志查看

Locator_desktop会生成日志文件，便于问题排查：
- **日志位置**：`%USERPROFILE%\AppData\Local\Locator_desktop\logs\locator.log`
- **日志级别**：默认INFO级别，可在配置文件中修改

### 8.2 常见错误及解决方法

| 错误信息 | 可能原因 | 解决方法 |
|----------|----------|----------|
| "元素未找到" | 元素已关闭或不可见 | 确保元素可见且未被遮挡 |
| "定位失败" | 定位表达式不准确 | 重新捕获元素或调整定位方式 |
| "应用连接失败" | 应用未运行或权限不足 | 确保应用正在运行，以管理员身份运行Locator_desktop |
| "图像识别失败" | 模板图像不匹配 | 重新截取模板图像，确保图像清晰 |

### 8.3 联系支持

如果您遇到无法解决的问题，可以通过以下方式联系支持：

- **官方网站**：[Locator_desktop官网](https://locator-desktop.com)
- **GitHub Issues**：[提交Issue](https://github.com/locator-desktop/locator-desktop/issues)
- **电子邮件**：support@locator-desktop.com

## 9. 版本更新

### 9.1 检查更新

Locator_desktop会自动检查更新，您也可以手动检查：
1. 点击菜单"帮助" → "检查更新"
2. 如果有新版本，按照提示进行更新

### 9.2 手动更新

在命令提示符中运行以下命令：
```bash
pip install --upgrade locator-desktop
```

### 9.3 版本历史

| 版本 | 发布日期 | 主要变化 |
|------|----------|----------|
| 1.0.0 | 2025-12-18 | 初始版本发布 |
| 1.1.0 | 2025-12-25 | 增加图像识别定位功能 |
| 1.2.0 | 2026-01-10 | 优化元素树加载性能 |

## 10. 卸载应用

### 10.1 通过控制面板卸载

1. 打开"控制面板"
2. 点击"程序和功能"
3. 找到"Locator_desktop"
4. 点击"卸载"
5. 按照提示完成卸载

### 10.2 通过pip卸载

在命令提示符中运行：
```bash
pip uninstall locator-desktop
```

### 10.3 清理残留文件

卸载后，您可以手动清理以下残留文件：
- 日志文件：`%USERPROFILE%\AppData\Local\Locator_desktop\logs`
- 配置文件：`%USERPROFILE%\AppData\Local\Locator_desktop\config`

## 11. 版权信息

© 2025 Locator_desktop. 保留所有权利。

Locator_desktop是一款开源软件，遵循MIT许可证。

## 12. 免责声明

Locator_desktop仅供学习和开发使用，请勿用于非法用途。

使用Locator_desktop时，请遵守相关法律法规和应用程序的使用条款。

对于因使用Locator_desktop而导致的任何损失或损害，开发者不承担任何责任。

---

感谢您使用Locator_desktop！如果您有任何建议或反馈，欢迎联系我们。